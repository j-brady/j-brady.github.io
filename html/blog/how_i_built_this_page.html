<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-12-23 Thu 14:48 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How I built this website</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Jacob P Brady">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alegreya&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css">
<link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
<div id="content">
<header>
<h1 class="title">How I built this website</h1>
</header><pre class="example">
relative
</pre>


<p>
I built this site using Emacs and Org-Mode. The literate programming capabilities built into Org-Mode with Org-Babel were particularly useful for evaluating and rendering the Python source code blocks. The source code for the web site is also available from my <a href="https://github.com/j-brady/j-brady.github.io">GitHub</a> repo. I have laid out some of the important details for putting the page together below and all source files were rendered using Org-mode's <code>#+INCLUDE:</code> tag (<a href="https://orgmode.org/manual/Include-Files.html">see docs</a>) ensuring that they are up-to-date.
</p>

<div id="outline-container-org18ee594" class="outline-2">
<h2 id="org18ee594">Org-Mode</h2>
<div class="outline-text-2" id="text-org18ee594">
<p>
To avoid rendering large blocks of source code and cluttering the pages I implemented a "hacky" solution for collapsible source code blocks using a combination of inline HTML, CSS and JavaScript. This is not ideal but is the best that I could manage without expending too much time.
</p>

<p>
Above each source block I added the following inline HTML:
</p>

<button type="button" class="collapsible">Toggle code</button>
<div class="org-src-container">
<pre class="src src-org">#+HTML: &lt;button type="button" class="collapsible"&gt;Toggle code&lt;/button
</pre>
</div>

<p>
For the case where I wanted all code blocks to be hidden by default I added the following HTML and to the bottom of the org-file.
</p>

<button type="button" class="collapsible">Toggle code</button>
<div class="org-src-container">
<pre class="src src-org">#+HTML_HEAD: &lt;style&gt; .org-src-container {padding: 0 18px; display: none; overflow: hidden; background-color: #f1f1f1;} &lt;/style&gt;
#+begin_export html
&lt;script&gt;
    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i &lt; coll.length; i++) {
	coll[i].addEventListener("click", function() {
	    this.classList.toggle("active");
	    var content = this.nextElementSibling;
	    if (content.style.display === "block") {
		content.style.display = "none";
		} else {
		content.style.display = "block";
	    }
	});
    }
&lt;/script&gt;
#+end_export
</pre>
</div>

<p>
In the case where I want the source blocks to be visible by default  (this page) I used the following:
</p>

<button type="button" class="collapsible">Toggle code</button>
<div class="org-src-container">
<pre class="src src-org">#+begin_export html
&lt;script&gt;
    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i &lt; coll.length; i++) {
	coll[i].addEventListener("click", function() {
	    this.classList.toggle("active");
	    var content = this.nextElementSibling;
	    if (content.style.display === "none") {
		content.style.display = "block";
		} else {
		content.style.display = "none";
	    }
	});
    }
&lt;/script&gt;
#+end_export
</pre>
</div>
</div>
</div>



<div id="outline-container-orgf6f1e90" class="outline-2">
<h2 id="orgf6f1e90">Emacs-lisp</h2>
<div class="outline-text-2" id="text-orgf6f1e90">
<p>
The Emacs-lisp code used to publish the web page
</p>

<button type="button" class="collapsible">Toggle code</button>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(require 'ox-publish)

;;; Code:
;;;
(setq org-link-file-path-type 'relative)
(setq org-publish-project-alist
      '(
	("j-brady.github.io-content"
	:base-directory "./"
	:base-extension "org"
	:publishing-directory "./html/"
	:recursive t
	:publishing-function org-html-publish-to-html
	:headline-levels 4
	;:auto-preamble t
	:auto-sitemap t                ; Generate sitemap.org automagically...
	:sitemap-filename "sitemap.org"  ; ... call it sitemap.org (it's the default)...
	:sitemap-title "Sitemap"         ; ... with title 'Sitemap'.
	:email "jacob.brady@protonmail.com"
	:author "Jacob P Brady"
	; HTML5
	:html-doctype "html5"
	:html-html5-fancy t
	; Disable some Org's HTML defaults
	:html-head-include-scripts nil
	:html-head-include-default-style nil
	; HTML preamble
	;:html-preamble
	:html-postamble "&lt;p class=\"author\"&gt;Author: %a (%e)&lt;/p&gt;&lt;p class=\"creator\"&gt;%c&lt;/p&gt;&lt;div id=\"updated\"&gt;Updated: %C&lt;/div&gt;")
       ("j-brady.github.io-static"
	:base-directory "./"
	:base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf"
	:publishing-directory "./html/"
	:recursive t
	:publishing-function org-publish-attachment
	)
       ("j-brady.github.io"
	:components ("j-brady.github.io-content" "j-brady.github.io-static"))))

(provide 'publish)
;;; publish.el
</pre>
</div>
</div>

<div id="outline-container-org1887ab5" class="outline-3">
<h3 id="org1887ab5">Setting relative paths</h3>
<div class="outline-text-3" id="text-org1887ab5">
<p>
In order for links to work properly on a server they should be relative. By default Org-mode's <code>org-link-file-path-type</code> is set to <code>'adaptive</code> which will convert paths like <code>../blog/filename.org</code> to absolute paths (not what we want). Therefore, I set this variable to <code>'relative</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq org-link-file-path-type 'relative)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2ffb9da" class="outline-2">
<h2 id="org2ffb9da">Makefile</h2>
<div class="outline-text-2" id="text-org2ffb9da">
<p>
Make is a very useful tool! Thanks to John Gosset of introducing it to me!
</p>

<button type="button" class="collapsible">Toggle code</button>
<div class="org-src-container">
<pre class="src src-make"># Makefile for mywebpage

.PHONY: all publish publish_no_init

all: clean publish

publish: publish.el
	@echo "Publishing... with current Emacs configurations."
	emacs --batch --load publish.el --funcall org-publish-all

publish_no_init: publish.el
	@echo "Publishing... with --no-init."
	emacs --batch --no-init --load publish.el --funcall org-publish-all

clean:
	@echo "Cleaning up.."
	@rm -rvf *.elc
	@rm -rvf html
	@rm -rvf ~/.org-timestamps/*
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2dc13c" class="outline-2">
<h2 id="orgd2dc13c">CSS</h2>
<div class="outline-text-2" id="text-orgd2dc13c">
<p>
The custom CSS code used to style the page is included below. For the collapsible code blocks I used this example from the <a href="https://www.w3schools.com/howto/howto_js_collapsible.asp">W3 Schools</a> website.
</p>

<button type="button" class="collapsible">Toggle code</button>
<div class="org-src-container">
<pre class="src src-css">body {
    font-family: 'Alegreya', serif;
    margin: 8px;
}
.title {
  text-align: center;
}

/* Larger than mobile screen */
@media (min-width: 40.0rem) {
  body {
    margin-left: 12rem;
    margin-right: 12rem;
    margin-top: 2rem;
  }
}

/* Larger than tablet screen */
@media (min-width: 80.0rem) {
  body {
    margin-left: 24rem;
    margin-right: 24rem;
    margin-top: 4rem;
  }
}

/* Larger than desktop screen */
@media (min-width: 120.0rem) {
  body {
    margin-left: 32rem;
    margin-right: 32rem;
    margin-top: 6rem;
  }
}

/* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
.active, .collapsible:hover {
  background-color: #ccc;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org72257ef" class="outline-2">
<h2 id="org72257ef">Todo</h2>
<div class="outline-text-2" id="text-org72257ef">
<ol class="org-ol">
<li>Improve collapsible source code block implementation
<ul class="org-ul">
<li><a href="https://alhassy.github.io/org-special-block-extras/">https://alhassy.github.io/org-special-block-extras/</a> could be a good way to go&#x2026;</li>
</ul></li>
<li>Enable syntax highlighting (I think this has something to do with using <code>emacs --batch</code> see <a href="#org2ffb9da">Makefile</a>)</li>
<li>Implement <code>target=_blank</code> for hyperlinks (presently all links open in the current tab)</li>
</ol>
</div>
</div>
<div id="outline-container-orgf1a97a7" class="outline-2">
<h2 id="orgf1a97a7">Useful links</h2>
<div class="outline-text-2" id="text-orgf1a97a7">
<p>
The following resources were extremely useful to me:
</p>
<ul class="org-ul">
<li><a href="https://orgmode.org/">https://orgmode.org/</a></li>
<li><a href="https://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html">https://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html</a></li>
<li><a href="https://opensource.com/article/20/3/blog-emacs">https://opensource.com/article/20/3/blog-emacs</a></li>
</ul>

<hr>
<p>
<a href="../index.html">Back to main page</a>
</p>
<hr>

<script>
    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.display === "none") {
                content.style.display = "block";
                } else {
                content.style.display = "none";
            }
        });
    }
</script>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Jacob P Brady (<a href="mailto:jacob.brady@protonmail.com">jacob.brady@protonmail.com</a>)</p><p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.2 (<a href="https://orgmode.org">Org</a> mode 9.4.4)</p><div id="updated">Updated: 2021-12-23 Thu 14:35</div>
</div>
</body>
</html>
